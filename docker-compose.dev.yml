version: '3.8'

services:
  esp32-api-dev:
    build: 
      context: .
      target: development
    container_name: esp32-image-api-dev
    ports:
      - "3000:3000"
      - "3443:3443"
      - "9229:9229"  # Node.js debugger port
    environment:
      - NODE_ENV=development
      - DEBUG=*
    env_file:
      - .env
    volumes:
      - ./azure-api:/app:delegated
      - ./certs:/app/certs:ro
      - ./logs:/app/logs
      - /app/node_modules  # Anonymous volume for node_modules
    restart: unless-stopped
    command: ["npm", "run", "dev"]
    networks:
      - esp32-network-dev

networks:
  esp32-network-dev:
    driver: bridge